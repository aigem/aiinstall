# AI åº”ç”¨ä¸€é”®å®‰è£…ç³»ç»Ÿ

ä¸€ä¸ªä¸º AI åº”ç”¨é‡èº«å®šåˆ¶çš„ Linux ç¯å¢ƒå®‰è£…è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ YAML é…ç½®æ–‡ä»¶å®ç°ä¸€é”®å¼è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚æœ¬ç³»ç»Ÿæ”¯æŒåœ¨ä¸åŒçš„ Linux ç¯å¢ƒï¼ˆåŒ…æ‹¬ Ubuntuã€CentOS ç­‰ï¼‰ä¸‹å®‰è£… AI åº”ç”¨ï¼Œä¸»è¦å¤„ç†ä¸åŒç¯å¢ƒä¸‹çš„è·¯å¾„å·®å¼‚å’Œæƒé™éœ€æ±‚ã€‚

## ç‰¹æ€§

- ğŸ”§ **é…ç½®é©±åŠ¨**: é€šè¿‡ YAML é…ç½®æ–‡ä»¶å®šä¹‰å®‰è£…æµç¨‹ï¼Œæ— éœ€ç¼–å†™è„šæœ¬
- ğŸ§ **å¤šç¯å¢ƒæ”¯æŒ**: æ”¯æŒ Ubuntuã€CentOSã€Alpine ç­‰ä¸»æµ Linux å‘è¡Œç‰ˆ
- ğŸ“¦ **æ¨¡å—åŒ–å®‰è£…**: æ ‡å‡†åŒ–çš„å®‰è£…æµç¨‹æ­¥éª¤æ§åˆ¶
- ğŸ“ **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„æ—¥å¿—è®°å½•ï¼ŒåŒ…æ‹¬å‘½ä»¤æ‰§è¡Œå’Œå®‰è£…è¿‡ç¨‹
- âš¡ **ç¯å¢ƒè‡ªæ£€**: è‡ªåŠ¨æ£€æµ‹å¹¶å®‰è£… Python è¿è¡Œç¯å¢ƒ

## å®‰è£…

å…‹éš†ä»“åº“åŠå®‰è£…ä¾èµ–ï¼š
   ```bash
   git clone https://cnb.cool/fuliai/aitools.git
   cd aitools && bash aitools.sh
   ```

å°†è·å–åˆ°çš„é…ç½®æ–‡ä»¶å¤åˆ¶åˆ° aitools/configs ç›®å½•ä¸‹ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š


## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å‘½ä»¤
1. ä½¿ç”¨é¢„è®¾ç¯å¢ƒå®‰è£…åº”ç”¨ï¼š

æŸ¥æ‰¾ configs ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨é¢„è®¾ç¯å¢ƒå®‰è£…åº”ç”¨ï¼š
   ```bash
   # å®‰è£…comfyui ä½¿ç”¨baseç¯å¢ƒ
   python -m installer install comfyui --env base

   ```

2. ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š
   ```bash
   # å®‰è£…æŒ‡å®šé…ç½®æ–‡ä»¶ ä½¿ç”¨githubç¯å¢ƒ
   python -m installer install --config configs/demo.yml -e github
   ```

3.å®‰è£…comfyuiæ’ä»¶ï¼š
å®‰è£…comfyui-sonic ä½¿ç”¨baseç¯å¢ƒ
   ```bash
   python -m installer install comfyui-sonic --env base
   ```

### é…ç½®æ–‡ä»¶ç¤ºä¾‹

### é…ç½®ç»§æ‰¿

ç³»ç»Ÿæ”¯æŒé…ç½®æ–‡ä»¶ç»§æ‰¿æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡ `parent` å­—æ®µæŒ‡å®šçˆ¶é…ç½®æ–‡ä»¶ï¼š

```yaml
version: "1.0"
name: "comfyui-sonic"
description: "å®‰è£… ComfyUI Sonic æ’ä»¶åŠå·¥ä½œæµ"
parent: "comfyui"  # æŒ‡å®šçˆ¶é…ç½®æ–‡ä»¶
install:
  environments:
    base:
      # åªéœ€è¦å®šä¹‰æ’ä»¶ç‰¹å®šçš„é…ç½®
      repo_name: "ComfyUI_Sonic"
      plugin_repo: "https://github.com/smthemex/ComfyUI_Sonic.git"
```

#### é…ç½®ç»§æ‰¿ç‰¹æ€§

1. **çˆ¶é…ç½®å¼•ç”¨**
   - ä½¿ç”¨ `parent` å­—æ®µæŒ‡å®šçˆ¶é…ç½®æ–‡ä»¶
   - çˆ¶é…ç½®æ–‡ä»¶å¿…é¡»åœ¨åŒä¸€ç›®å½•ä¸‹
   - è‡ªåŠ¨ç»§æ‰¿çˆ¶é…ç½®çš„æ‰€æœ‰è®¾ç½®

2. **å˜é‡å¼•ç”¨è¯­æ³•**
   - ä½¿ç”¨ `{parent.xxx}` è¯­æ³•å¼•ç”¨çˆ¶é…ç½®çš„å€¼
   - æ”¯æŒå¤šå±‚çº§å¼•ç”¨ï¼Œå¦‚ `{parent.environments.base.venv_dir}`
   - å¼•ç”¨çš„è·¯å¾„å¿…é¡»å­˜åœ¨äºçˆ¶é…ç½®ä¸­

3. **é…ç½®åˆå¹¶è§„åˆ™**
   - å­é…ç½®å¯ä»¥è¦†ç›–çˆ¶é…ç½®çš„å€¼
   - å¯¹è±¡ç±»å‹é…ç½®è¿›è¡Œæ·±åº¦åˆå¹¶
   - éå¯¹è±¡ç±»å‹é…ç½®ç›´æ¥è¦†ç›–

#### ä½¿ç”¨ç¤ºä¾‹

1. **åŸºç¡€é…ç½®** (comfyui.yml):
```yaml
version: "1.0"
name: "comfyui"
install:
  environments:
    base:
      base_dir: "/workspace"
      venv_dir: "venv_confyui"
      repo_name: "ComfyUI"
```

2. **æ’ä»¶é…ç½®** (comfyui-sonic.yml):
```yaml
version: "1.0"
name: "comfyui-sonic"
parent: "comfyui"
install:
  environments:
    base:
      repo_name: "ComfyUI_Sonic"  # è¦†ç›–ç‰¹å®šé…ç½®
  steps:
    - name: "å®‰è£…æ’ä»¶"
      common:
        - |
          cd {parent.environments.base.base_dir}/{parent.environments.base.repo_name}  # å¼•ç”¨çˆ¶é…ç½®è·¯å¾„
```

#### æœ€ä½³å®è·µ

1. **é…ç½®åˆ†å±‚**
   - åŸºç¡€åº”ç”¨ä½¿ç”¨ç‹¬ç«‹é…ç½®
   - æ’ä»¶å’Œæ‰©å±•é€šè¿‡ç»§æ‰¿å¤ç”¨é…ç½®
   - åªåœ¨å­é…ç½®ä¸­å®šä¹‰ç‰¹å®šçš„é…ç½®é¡¹

2. **è·¯å¾„ç®¡ç†**
   - ä½¿ç”¨çˆ¶é…ç½®ä¸­çš„è·¯å¾„é…ç½®
   - ä¿æŒè·¯å¾„ä¸€è‡´æ€§
   - é¿å…é‡å¤å®šä¹‰åŸºç¡€è·¯å¾„

3. **ç¯å¢ƒé…ç½®**
   - ç»§æ‰¿çˆ¶é…ç½®çš„ç¯å¢ƒè®¾ç½®
   - æ ¹æ®éœ€è¦è¦†ç›–ç‰¹å®šç¯å¢ƒå˜é‡
   - ä¿æŒç¯å¢ƒé…ç½®çš„ä¸€è‡´æ€§

### é…ç½®æ¨¡æ¿ç”Ÿæˆ

ä½¿ç”¨ç‹¬ç«‹é…ç½®æ–‡ä»¶ç”Ÿæˆç¨‹åºæ¥ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š

1. **æŸ¥çœ‹è¯´æ˜**ï¼šå‚è€ƒ `configs/variables.md` äº†è§£å¯ç”¨å˜é‡
2. **ä¿®æ”¹é…ç½®**ï¼šæ ¹æ®åº”ç”¨éœ€æ±‚ä¿®æ”¹ç”Ÿæˆçš„é…ç½®æ–‡ä»¶

### å˜é‡å’Œå‘½ä»¤æ¨¡æ¿

`configs/variables.md` æä¾›äº†è¯¦ç»†çš„å˜é‡è¯´æ˜å’Œå¸¸ç”¨å‘½ä»¤æ¨¡æ¿ï¼š

1. **å¯ç”¨å˜é‡**ï¼š
   - åŸºç¡€å˜é‡ï¼ˆåº”ç”¨ä¿¡æ¯ï¼‰
   - ç¯å¢ƒå˜é‡ï¼ˆè·¯å¾„ã€æƒé™ï¼‰
   - Python/pipç›¸å…³
   - è™šæ‹Ÿç¯å¢ƒ

2. **å‘½ä»¤æ¨¡æ¿**ï¼š
   - ç›®å½•æ“ä½œ
   - æƒé™è®¾ç½®
   - Pythonç¯å¢ƒé…ç½®
   - Gitæ“ä½œ
   - ä¾èµ–å®‰è£…

3. **ä½¿ç”¨æŠ€å·§**ï¼š
   - æ¡ä»¶æ‰§è¡Œ
   - å˜é‡ç»„åˆ
   - å¤šè¡Œå‘½ä»¤
   - ç¯å¢ƒæ£€æŸ¥

```yaml
version: "1.0"
name: "comfyui"
description: "Stable Diffusion å¯è§†åŒ–å·¥ä½œæµç¯å¢ƒ"

# ä½¿ç”¨é¢„è®¾ç¯å¢ƒ
environment: "ubuntu-a"

# å®‰è£…æ­¥éª¤
steps:
  - name: "prepare"
    description: "å‡†å¤‡ç¯å¢ƒ"
    common:
      - "uv venv {venv_dir} --python={python_ver}"
      - ". {venv_dir}/bin/activate"
      - "uv pip install --upgrade pip -i {pip_index}"
```

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| {name} | åº”ç”¨åç§° | "comfyui" |
| {base_dir} | å®‰è£…ç›®å½• | "/home/user/ai_apps/comfyui" |
| {python_cmd} | Python å‘½ä»¤ | "python3" |
| {use_sudo} | æ˜¯å¦ä½¿ç”¨ sudo | "true" |
| {pip_index} | pipé•œåƒæº | "https://pypi.org/simple" |
| {pip_timeout} | pipè¶…æ—¶æ—¶é—´ | 60 |
| {pip_retries} | pipé‡è¯•æ¬¡æ•° | 3 |
| {venv_dir} | è™šæ‹Ÿç¯å¢ƒç›®å½• | "venv_confyui" |
| {python_ver} | Python ç‰ˆæœ¬ | "3.12.9" |
| {app_repo} | åº”ç”¨ä»“åº“åœ°å€ | "https://openi.pcl.ac.cn/niubi/ComfyUI.git" |
| {repo_name} | ä»“åº“ç›®å½•å | "ComfyUI" |
| {parent.xxx} | çˆ¶é…ç½®å¼•ç”¨ | "{parent.environments.base.venv_dir}" |

### è‡ªå®šä¹‰å®‰è£…

ä½¿ç”¨ `--set` å‚æ•°è¦†ç›–é…ç½®å˜é‡ï¼š
```bash
# åŸºç¡€åº”ç”¨å®‰è£…
python -m installer install comfyui --env ubuntu-a --set base_dir=/custom/path

# æ’ä»¶å®‰è£…ï¼ˆä¼šè‡ªåŠ¨ç»§æ‰¿çˆ¶é…ç½®çš„è®¾ç½®ï¼‰
python -m installer install comfyui-sonic --env ubuntu-a
```

## æ—¥å¿—ç³»ç»Ÿ

å®‰è£…è¿‡ç¨‹çš„æ—¥å¿—æ–‡ä»¶ä½äº `logs` ç›®å½•ï¼š

- `{app_name}_install.log`: å®‰è£…è¿‡ç¨‹æ—¥å¿—
- `{app_name}_commands.log`: æ‰€æœ‰æ‰§è¡Œå‘½ä»¤çš„è¯¦ç»†æ—¥å¿—
- `{app_name}_installer.log`: å®‰è£…å™¨è¿è¡Œæ—¥å¿—

## é”™è¯¯å¤„ç†

1. é…ç½®é”™è¯¯ï¼š
   ```
   é”™è¯¯: é…ç½®æ–‡ä»¶å¿…é¡»åŒ…å« version å’Œ name å­—æ®µ
   ```

2. ç¯å¢ƒé”™è¯¯ï¼š
   ```
   é”™è¯¯: ç¯å¢ƒ ubuntu-c æœªåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰
   ```

3. å‘½ä»¤æ‰§è¡Œé”™è¯¯ï¼š
   ```
   é”™è¯¯: å®‰è£…å¤±è´¥: å‘½ä»¤æ‰§è¡Œå¤±è´¥: Permission denied
   å‘½ä»¤: mkdir -p /opt/ai/test
   ```

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
installer/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ cli.py                # å‘½ä»¤è¡Œå…¥å£
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config.py         # é…ç½®åŠ è½½å’ŒéªŒè¯
â”‚   â”œâ”€â”€ installer.py      # å®‰è£…æµç¨‹æ§åˆ¶
â”‚   â”œâ”€â”€ executor.py       # å‘½ä»¤æ‰§è¡Œå™¨
â”‚   â””â”€â”€ logger.py         # æ—¥å¿—ç®¡ç†
â””â”€â”€ templates/            # é…ç½®æ¨¡æ¿
```

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `core` ç›®å½•ä¸‹åˆ›å»ºæ–°æ¨¡å—
2. åœ¨ `cli.py` ä¸­æ·»åŠ æ–°å‘½ä»¤
3. æ›´æ–°æµ‹è¯•å’Œæ–‡æ¡£

### æµ‹è¯•

ä½¿ç”¨æœ€å°åŒ–æµ‹è¯•é…ç½®éªŒè¯åŠŸèƒ½ï¼š
```bash
python -m installer install --config configs/demo.yml --env ubuntu-a
```

## å¸¸è§é—®é¢˜

1. **å®‰è£…å¤±è´¥å¦‚ä½•ç»§ç»­ï¼Ÿ**
   - æ£€æŸ¥æ—¥å¿—æ–‡ä»¶äº†è§£å¤±è´¥åŸå› 
   - ä¿®å¤é—®é¢˜åé‡æ–°è¿è¡Œå®‰è£…å‘½ä»¤

2. **å¦‚ä½•åœ¨æ–°ç¯å¢ƒä¸­ä½¿ç”¨ï¼Ÿ**
   - åœ¨é…ç½®æ–‡ä»¶çš„ `environments` éƒ¨åˆ†æ·»åŠ æ–°ç¯å¢ƒ
   - ç¡®ä¿è®¾ç½®æ­£ç¡®çš„è·¯å¾„å’Œæƒé™

3. **æ”¯æŒå“ªäº› Python ç‰ˆæœ¬ï¼Ÿ**
   - å»ºè®®ä½¿ç”¨ Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
   - å…·ä½“ç‰ˆæœ¬è¦æ±‚è¯·å‚è€ƒåº”ç”¨é…ç½®æ–‡ä»¶

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ· Pull Request

## è®¸å¯è¯

[MIT License](LICENSE)

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»ç»´æŠ¤è€…ã€‚ 